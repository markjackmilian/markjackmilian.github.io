Bridge.assembly("realworld.spaf",function(){"use strict";Bridge.define("Bridge.Spaf.CustomRoutesConfig",{inherits:[Bridge.Navigation.BridgeNavigatorConfigBase],fields:{_userService:null,DisableAutoSpafAnchorsOnNavigate:!1,Body:null,HomeId:null},props:{VirtualDirectory:{get:function(){return System.String.isNullOrEmpty(Bridge.Navigation.NavigationUtility.VirtualDirectory)?"":System.String.format("{0}/",[Bridge.Navigation.NavigationUtility.VirtualDirectory])}}},alias:["DisableAutoSpafAnchorsOnNavigate","Bridge$Navigation$INavigatorConfigurator$DisableAutoSpafAnchorsOnNavigate","CreateRoutes","Bridge$Navigation$INavigatorConfigurator$CreateRoutes","Body","Bridge$Navigation$INavigatorConfigurator$Body","HomeId","Bridge$Navigation$INavigatorConfigurator$HomeId"],ctors:{init:function(){this.DisableAutoSpafAnchorsOnNavigate=!1;this.Body=$("#pageBody");this.HomeId=Bridge.Spaf.SpafApp.HomeId},ctor:function(userService){this.$initialize();Bridge.Navigation.BridgeNavigatorConfigBase.ctor.call(this);this._userService=userService}},methods:{CreateRoutes:function(){return Bridge.fn.bind(this,function(_o1){var $t;return _o1.add(($t=new Bridge.Navigation.PageDescriptor,$t.CanBeDirectLoad=function(){return!0},$t.HtmlLocation=Bridge.fn.bind(this,function(){return System.String.format("{0}pages/home.html",[this.VirtualDirectory])}),$t.Key=Bridge.Spaf.SpafApp.HomeId,$t.PageController=function(){return Bridge.Spaf.SpafApp.Container.Bridge$Ioc$IIoc$Resolve(realworld.spaf.ViewModels.HomeViewModel)},$t)),_o1.add(($t=new Bridge.Navigation.PageDescriptor,$t.CanBeDirectLoad=function(){return!0},$t.HtmlLocation=Bridge.fn.bind(this,function(){return System.String.format("{0}pages/login.html",[this.VirtualDirectory])}),$t.Key=Bridge.Spaf.SpafApp.LoginId,$t.PageController=function(){return Bridge.Spaf.SpafApp.Container.Bridge$Ioc$IIoc$Resolve(realworld.spaf.ViewModels.LoginViewModel)},$t)),_o1.add(($t=new Bridge.Navigation.PageDescriptor,$t.CanBeDirectLoad=function(){return!0},$t.HtmlLocation=Bridge.fn.bind(this,function(){return System.String.format("{0}pages/register.html",[this.VirtualDirectory])}),$t.Key=Bridge.Spaf.SpafApp.RegisterId,$t.PageController=function(){return Bridge.Spaf.SpafApp.Container.Bridge$Ioc$IIoc$Resolve(realworld.spaf.ViewModels.RegisterViewModel)},$t)),_o1.add(($t=new Bridge.Navigation.PageDescriptor,$t.CanBeDirectLoad=function(){return!0},$t.HtmlLocation=Bridge.fn.bind(this,function(){return System.String.format("{0}pages/profile.html",[this.VirtualDirectory])}),$t.Key=Bridge.Spaf.SpafApp.ProfileId,$t.PageController=function(){return Bridge.Spaf.SpafApp.Container.Bridge$Ioc$IIoc$Resolve(realworld.spaf.ViewModels.ProfileViewModel)},$t)),_o1.add(($t=new Bridge.Navigation.PageDescriptor,$t.CanBeDirectLoad=Bridge.fn.bind(this,function(){return this._userService.realworld$spaf$Services$IUserService$IsLogged}),$t.HtmlLocation=Bridge.fn.bind(this,function(){return System.String.format("{0}pages/settings.html",[this.VirtualDirectory])}),$t.Key=Bridge.Spaf.SpafApp.SettingsId,$t.PageController=function(){return Bridge.Spaf.SpafApp.Container.Bridge$Ioc$IIoc$Resolve(realworld.spaf.ViewModels.SettingsViewModel)},$t)),_o1.add(($t=new Bridge.Navigation.PageDescriptor,$t.CanBeDirectLoad=function(){return!1},$t.HtmlLocation=Bridge.fn.bind(this,function(){return System.String.format("{0}pages/editArticle.html",[this.VirtualDirectory])}),$t.Key=Bridge.Spaf.SpafApp.EditArticleId,$t.PageController=function(){return Bridge.Spaf.SpafApp.Container.Bridge$Ioc$IIoc$Resolve(realworld.spaf.ViewModels.EditArticleViewModel)},$t)),_o1.add(($t=new Bridge.Navigation.PageDescriptor,$t.CanBeDirectLoad=function(){return!0},$t.HtmlLocation=Bridge.fn.bind(this,function(){return System.String.format("{0}pages/article.html",[this.VirtualDirectory])}),$t.Key=Bridge.Spaf.SpafApp.ArticleId,$t.PageController=function(){return Bridge.Spaf.SpafApp.Container.Bridge$Ioc$IIoc$Resolve(realworld.spaf.ViewModels.ArticleViewModel)},$t)),_o1})(new(System.Collections.Generic.List$1(Bridge.Navigation.IPageDescriptor).ctor))}}});Bridge.define("Bridge.Spaf.SpafApp",{main:function(){var $step=0,$asyncBody=Bridge.fn.bind(this,function(){for(;;){$step=System.Array.min([0],$step);switch($step){case 0:return;default:return}}},arguments);$asyncBody()},statics:{fields:{Container:null},props:{HomeId:{get:function(){return"home"}},LoginId:{get:function(){return"login"}},RegisterId:{get:function(){return"register"}},ProfileId:{get:function(){return"profile"}},SettingsId:{get:function(){return"settings"}},EditArticleId:{get:function(){return"editArticle"}},ArticleId:{get:function(){return"article"}}},methods:{ContainerConfig:function(){Bridge.Spaf.SpafApp.Container.Bridge$Ioc$IIoc$RegisterSingleInstance$3(Bridge.Navigation.INavigator,Bridge.Navigation.BridgeNavigatorWithRouting);Bridge.Spaf.SpafApp.Container.Bridge$Ioc$IIoc$Register$4(Bridge.Navigation.INavigatorConfigurator,Bridge.Spaf.CustomRoutesConfig);Bridge.Spaf.SpafApp.Container.Bridge$Ioc$IIoc$RegisterSingleInstance$3(Bridge.Messenger.IMessenger,Bridge.Messenger.Messenger);Bridge.Spaf.SpafApp.RegisterAllViewModels();Bridge.Spaf.SpafApp.Container.Bridge$Ioc$IIoc$RegisterSingleInstance$3(realworld.spaf.Services.ISettings,realworld.spaf.Services.impl.Settings);Bridge.Spaf.SpafApp.Container.Bridge$Ioc$IIoc$RegisterSingleInstance$3(realworld.spaf.Services.IUserService,realworld.spaf.Services.impl.UserService);Bridge.Spaf.SpafApp.Container.Bridge$Ioc$IIoc$Register$4(realworld.spaf.Services.IArticleResources,realworld.spaf.Services.impl.ArticleResources);Bridge.Spaf.SpafApp.Container.Bridge$Ioc$IIoc$Register$4(realworld.spaf.Services.IUserResources,realworld.spaf.Services.impl.UserResources);Bridge.Spaf.SpafApp.Container.Bridge$Ioc$IIoc$Register$4(realworld.spaf.Services.IFeedResources,realworld.spaf.Services.impl.FeedResources);Bridge.Spaf.SpafApp.Container.Bridge$Ioc$IIoc$Register$4(realworld.spaf.Services.IProfileResources,realworld.spaf.Services.impl.ProfileResources);Bridge.Spaf.SpafApp.Container.Bridge$Ioc$IIoc$Register$4(realworld.spaf.Services.IRepository,realworld.spaf.Services.impl.LocalStorageRepository);Bridge.Spaf.SpafApp.Container.Bridge$Ioc$IIoc$Register$4(realworld.spaf.Services.ISettingsResources,realworld.spaf.Services.impl.SettingsResources)},RegisterAllViewModels:function(){var types=System.Linq.Enumerable.from(System.AppDomain.getAssemblies()).selectMany(function(s){return Bridge.Reflection.getAssemblyTypes(s)}).where(function(w){return System.String.endsWith(Bridge.Reflection.getTypeName(w).toLowerCase(),"viewmodel")}).toList(Function);types.forEach(function(f){var attributes=Bridge.Reflection.getAttributes(f,Bridge.Spaf.Attributes.SingleInstanceAttribute,!0);System.Linq.Enumerable.from(attributes).any()?Bridge.Spaf.SpafApp.Container.Bridge$Ioc$IIoc$RegisterSingleInstance(f):Bridge.Spaf.SpafApp.Container.Bridge$Ioc$IIoc$Register(f)})}}}});Bridge.define("Bridge.Spaf.SpafApp.Messages",{$kind:"nested class",statics:{fields:{Sender:null},props:{LoginDone:{get:function(){return"LoginDone"}}},ctors:{init:function(){this.Sender=new Bridge.Spaf.SpafApp.Messages.GlobalSender}}}});Bridge.define("Bridge.Spaf.SpafApp.Messages.GlobalSender",{$kind:"nested class"});Bridge.define("realworld.spaf.Classes.Extensions",{statics:{methods:{GetValidationErrorResponse:function(exception){var $t,errors=Bridge.cast(Newtonsoft.Json.JsonConvert.DeserializeObject(($t=exception.arguments)[System.Array.index(0,$t)].responseJSON,realworld.spaf.Models.Response.ErrorResponse),realworld.spaf.Models.Response.ErrorResponse);return errors.Errors},GetValidationErrors:function(){return new(Bridge.GeneratorEnumerable$1(System.String))(Bridge.fn.bind(this,function(exception){var $step=0,errors,$t,error,$t1,errorDescription,$async_e,$enumerator=new(Bridge.GeneratorEnumerator$1(System.String))(Bridge.fn.bind(this,function(){try{for(;;)switch($step){case 0:errors=realworld.spaf.Classes.Extensions.GetValidationErrorResponse(exception);$t=Bridge.getEnumerator(errors);$step=1;continue;case 1:if($t.moveNext()){error=$t.Current;$step=2;continue}$step=7;continue;case 2:$t1=Bridge.getEnumerator(error.value);$step=3;continue;case 3:if($t1.moveNext()){errorDescription=$t1.Current;$step=4;continue}$step=6;continue;case 4:return $enumerator.current=System.String.format("{0} {1}",error.key,errorDescription),$step=5,!0;case 5:$step=3;continue;case 6:$step=1;continue;case 7:default:return!1}}catch($async_e1){$async_e=System.Exception.create($async_e1);throw $async_e;}}));return $enumerator},arguments))},GetErrorForCode:function(errorCode){switch(errorCode){case 401:return"Unauthorized";case 403:return"Forbidden";case 404:return"Not Found";case 422:return"Validation Error";default:return"Generic Error"}},ErrorCode:function(exception){var $t;return Bridge.cast(($t=exception.arguments)[System.Array.index(0,$t)].status,System.Int32)}}}});Bridge.define("realworld.spaf.Classes.FeedRequestBuilder",{statics:{methods:{Default:function(){return new realworld.spaf.Classes.FeedRequestBuilder}}},fields:{_offset:0,_limit:0},ctors:{ctor:function(){this.$initialize();this._limit=20;this._offset=0}},methods:{WithOffSet:function(offset){return this._offset=offset,this},WithLimit:function(limit){return this._limit=limit,this},Build:function(){var stringBuilder=new System.Text.StringBuilder("articles/feed");return stringBuilder.append(System.String.format("?limit={0}",[Bridge.box(this._limit,System.Int32)])),stringBuilder.append(System.String.format("&&offset={0}",[Bridge.box(this._offset,System.Int32)])),stringBuilder.toString()}}});Bridge.define("realworld.spaf.Models.Article",{fields:{Title:null,Slug:null,Body:null,CreatedAt:null,UpdatedAt:null,TagList:null,Description:null,Author:null,Favorited:!1,FavoritesCount:System.Int64(0)},props:{Create:{get:function(){var $t;return Bridge.equals($t=this.CreatedAt,null)?null:System.DateTime.format($t,"MMMM dd")}}},ctors:{ctor:function(){this.$initialize();this.Author=new realworld.spaf.Models.Author}}});Bridge.define("realworld.spaf.Models.Author",{fields:{Username:null,Bio:null,Image:null,Following:!1}});Bridge.define("realworld.spaf.Models.Comment",{fields:{Id:System.Int64(0),CreatedAt:null,UpdatedAt:null,Body:null,Author:null},props:{Create:{get:function(){return System.DateTime.format(this.CreatedAt,"MMMM dd")}}},ctors:{init:function(){this.CreatedAt=System.DateTime.getDefaultValue();this.UpdatedAt=System.DateTime.getDefaultValue()},ctor:function(){this.$initialize();this.Author=new realworld.spaf.Models.Author}}});Bridge.define("realworld.spaf.Models.NewArticle",{fields:{Title:null,Description:null,Body:null,TagList:null}});Bridge.define("realworld.spaf.Models.Paginator",{fields:{Active:null,Page:0},ctors:{ctor:function(){this.$initialize();this.Active=ko.observable()}}});Bridge.define("realworld.spaf.Models.Profile",{fields:{Username:null,Bio:null,Image:null,Following:!1}});Bridge.define("realworld.spaf.Models.Request.NewArticleRequest",{fields:{Article:null}});Bridge.define("realworld.spaf.Models.Request.SettingsRequest",{fields:{ImageUri:null,Username:null,Biography:null,Email:null,NewPassword:null}});Bridge.define("realworld.spaf.Models.Request.SignRequest",{fields:{User:null}});Bridge.define("realworld.spaf.Models.Request.UserRequest",{fields:{Username:null,Email:null,Password:null}});Bridge.define("realworld.spaf.Models.Response.ArticleResponse",{fields:{Articles:null,ArticlesCount:System.Int64(0)}});Bridge.define("realworld.spaf.Models.Response.CommentsResponse",{fields:{Comments:null}});Bridge.define("realworld.spaf.Models.Response.ErrorResponse",{fields:{Errors:null}});Bridge.define("realworld.spaf.Models.Response.FollowResponse",{fields:{Profile:null}});Bridge.define("realworld.spaf.Models.Response.ProfileResponse",{fields:{Profile:null}});Bridge.define("realworld.spaf.Models.Response.SettingsResponse",{fields:{User:null}});Bridge.define("realworld.spaf.Models.Response.SignResponse",{fields:{User:null}});Bridge.define("realworld.spaf.Models.Response.SingleArticleResponse",{fields:{Article:null}});Bridge.define("realworld.spaf.Models.Response.SingleCommentResponse",{fields:{Comment:null}});Bridge.define("realworld.spaf.Models.Response.TagsResponse",{fields:{Tags:null}});Bridge.define("realworld.spaf.Models.User",{fields:{Id:0,Email:null,Token:null,Username:null,Bio:null,Image:null}});Bridge.define("realworld.spaf.Services.IArticleResources",{$kind:"interface"});Bridge.define("realworld.spaf.Services.IFeedResources",{$kind:"interface"});Bridge.define("realworld.spaf.Services.impl.ArticleRequestBuilder",{statics:{methods:{Default:function(){return new realworld.spaf.Services.impl.ArticleRequestBuilder}}},fields:{_tag:null,_author:null,_offset:0,_limit:0,_user:null},ctors:{ctor:function(){this.$initialize();this._limit=20;this._offset=0}},methods:{WithOffSet:function(offset){return this._offset=offset,this},WithLimit:function(limit){return this._limit=limit,this},OfAuthor:function(author){return this._author=author,this},WithTag:function(tag){return this._tag=tag,this},OfFavorite:function(user){return this._user=user,this},Build:function(){var stringBuilder=new System.Text.StringBuilder("articles");return stringBuilder.append(System.String.format("?limit={0}",[Bridge.box(this._limit,System.Int32)])),stringBuilder.append(System.String.format("&&offset={0}",[Bridge.box(this._offset,System.Int32)])),System.String.isNullOrEmpty(this._tag)||stringBuilder.append(System.String.format("&&tag={0}",[this._tag])),System.String.isNullOrEmpty(this._author)||stringBuilder.append(System.String.format("&&author={0}",[this._author])),System.String.isNullOrEmpty(this._user)||stringBuilder.append(System.String.format("&&favorited={0}",[this._user])),stringBuilder.toString()}}});Bridge.define("realworld.spaf.Services.impl.ResourceBase",{methods:{MakeCall:function(T,options){return System.Threading.Tasks.Task.fromPromise($.ajax(options),function(resObj){var json=JSON.stringify(Bridge.unbox(resObj));return Newtonsoft.Json.JsonConvert.DeserializeObject(json,T)})}}});Bridge.define("realworld.spaf.Services.IRepository",{$kind:"interface"});Bridge.define("realworld.spaf.Services.IProfileResources",{$kind:"interface"});Bridge.define("realworld.spaf.Services.ISettings",{$kind:"interface"});Bridge.define("realworld.spaf.Services.ISettingsResources",{$kind:"interface"});Bridge.define("realworld.spaf.Services.IUserResources",{$kind:"interface"});Bridge.define("realworld.spaf.Services.IUserService",{$kind:"interface"});Bridge.define("realworld.spaf.ViewModels.ArticleViewModel",{inherits:[Bridge.Spaf.LoadableViewModel],fields:{_articleResources:null,_userService:null,_navigator:null,_profileResources:null,Article:null,Comments:null,Comment:null},props:{IsLogged:{get:function(){return this._userService.realworld$spaf$Services$IUserService$IsLogged}},LoggedUser:{get:function(){return this._userService.realworld$spaf$Services$IUserService$LoggedUser}}},alias:["OnLoad","Bridge$Navigation$IAmLoadable$OnLoad"],ctors:{ctor:function(articleResources,userService,navigator,profileResources){this.$initialize();Bridge.Spaf.LoadableViewModel.ctor.call(this);this._articleResources=articleResources;this._userService=userService;this._navigator=navigator;this._profileResources=profileResources;this.Article=new realworld.spaf.Models.Article;this.Comments=ko.observableArray();this.Comment=ko.observable()}},methods:{ElementId:function(){return Bridge.Spaf.SpafApp.ArticleId},OnLoad:function(parameters){var $step=0,$task1,slug,articleTask,commentsTask,$asyncBody=Bridge.fn.bind(this,function(){for(;;){$step=System.Array.min([0,1],$step);switch($step){case 0:if(Bridge.Spaf.LoadableViewModel.prototype.OnLoad.call(this,parameters),slug=Bridge.Navigation.NavigationUtility.GetParameter(System.String,parameters,"slug"),System.String.isNullOrEmpty(slug))throw new System.Exception("Article page need slug parameter");articleTask=this.LoadArticle(slug);commentsTask=this.LoadComments(slug);$task1=System.Threading.Tasks.Task.whenAll(articleTask,commentsTask);$step=1;$task1.continueWith($asyncBody,!0);return;case 1:$task1.getAwaitedResult();this.RefreshBinding();this._navigator.Bridge$Navigation$INavigator$EnableSpafAnchors();return;default:return}}},arguments);$asyncBody()},AddComment:function(){var $step=0,$task1,$taskResult1,$tcs=new System.Threading.Tasks.TaskCompletionSource,commentResponse,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=System.Array.min([0,1],$step);switch($step){case 0:if(!this.IsLogged){$tcs.setResult(null);return}$task1=this._articleResources.realworld$spaf$Services$IArticleResources$AddComment(this.Article.Slug,this.Comment());$step=1;$task1.continueWith($asyncBody);return;case 1:$taskResult1=$task1.getAwaitedResult();commentResponse=$taskResult1;this.Comment("");this.Comments.push(commentResponse.Comment);$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=System.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},FollowAuthor:function(){var $step=0,$task1,$taskResult1,$tcs=new System.Threading.Tasks.TaskCompletionSource,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=System.Array.min([0,1],$step);switch($step){case 0:$task1=this._profileResources.realworld$spaf$Services$IProfileResources$Follow(this.Article.Author.Username);$step=1;$task1.continueWith($asyncBody);return;case 1:$taskResult1=$task1.getAwaitedResult();$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=System.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},RefreshBinding:function(){ko.cleanNode(this.PageNode);this.ApplyBindings()},LoadComments:function(slug){var $step=0,$task1,$taskResult1,$tcs=new System.Threading.Tasks.TaskCompletionSource,comment,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=System.Array.min([0,1],$step);switch($step){case 0:$task1=this._articleResources.realworld$spaf$Services$IArticleResources$GetArticleComments(slug);$step=1;$task1.continueWith($asyncBody);return;case 1:$taskResult1=$task1.getAwaitedResult();comment=$taskResult1;this.Comments.push.apply(this.Comments,comment.Comments);$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=System.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},LoadArticle:function(slug){var $step=0,$task1,$taskResult1,$tcs=new System.Threading.Tasks.TaskCompletionSource,article,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=System.Array.min([0,1],$step);switch($step){case 0:$task1=this._articleResources.realworld$spaf$Services$IArticleResources$GetArticle(slug);$step=1;$task1.continueWith($asyncBody);return;case 1:$taskResult1=$task1.getAwaitedResult();article=$taskResult1;this.Article=article.Article;$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=System.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task}}});Bridge.define("realworld.spaf.ViewModels.EditArticleViewModel",{inherits:[Bridge.Spaf.LoadableViewModel],fields:{_articleResources:null,_navigator:null,Title:null,Body:null,Description:null,Tags:null},alias:["OnLoad","Bridge$Navigation$IAmLoadable$OnLoad"],ctors:{ctor:function(articleResources,navigator){this.$initialize();Bridge.Spaf.LoadableViewModel.ctor.call(this);this._articleResources=articleResources;this._navigator=navigator;this.Title=ko.observable();this.Body=ko.observable();this.Description=ko.observable();this.Tags=ko.observable()}},methods:{ElementId:function(){return Bridge.Spaf.SpafApp.EditArticleId},OnLoad:function(parameters){Bridge.Spaf.LoadableViewModel.prototype.OnLoad.call(this,parameters)},Create:function(){var $step=0,$task1,$taskResult1,$tcs=new System.Threading.Tasks.TaskCompletionSource,newArticel,$t,$t1,article,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=System.Array.min([0,1],$step);switch($step){case 0:newArticel=($t=new realworld.spaf.Models.Request.NewArticleRequest,$t.Article=($t1=new realworld.spaf.Models.NewArticle,$t1.Title=this.Title(),$t1.Body=this.Body(),$t1.Description=this.Description(),$t1.TagList=System.Linq.Enumerable.from(System.String.split(this.Tags(),[44].map(function(i){return String.fromCharCode(i)}))).toArray(),$t1),$t);$task1=this._articleResources.realworld$spaf$Services$IArticleResources$Create(newArticel);$step=1;$task1.continueWith($asyncBody);return;case 1:$taskResult1=$task1.getAwaitedResult();article=$taskResult1;this._navigator.Bridge$Navigation$INavigator$Navigate(Bridge.Spaf.SpafApp.ArticleId,function(_o1){return _o1.add("slug",article.Article.Slug),_o1}(new(System.Collections.Generic.Dictionary$2(System.String,System.Object))));$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=System.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task}}});Bridge.define("realworld.spaf.ViewModels.HomeViewModel",{inherits:[Bridge.Spaf.LoadableViewModel],fields:{_tagFilter:null,_resources:null,_settings:null,_messenger:null,_userService:null,_feedResources:null,_navigator:null,Articles:null,Pages:null,Tags:null,ActiveTabIndex:null,Tabs:null,IsLogged:null},alias:["OnLoad","Bridge$Navigation$IAmLoadable$OnLoad","OnLeave","Bridge$Navigation$IAmLoadable$OnLeave"],ctors:{ctor:function(resources,settings,messenger,userService,feedResources,navigator){this.$initialize();Bridge.Spaf.LoadableViewModel.ctor.call(this);this._resources=resources;this._settings=settings;this._messenger=messenger;this._userService=userService;this._feedResources=feedResources;this._navigator=navigator;this.Articles=ko.observableArray();this.Pages=ko.observableArray();this.Tags=ko.observableArray();this.Tabs=ko.observableArray();this.IsLogged=ko.observable(this._userService.realworld$spaf$Services$IUserService$IsLogged);this.ActiveTabIndex=ko.observable(-1)}},methods:{ElementId:function(){return Bridge.Spaf.SpafApp.HomeId},OnLoad:function(parameters){var $step=0,$task1,articlesTask,loadTagsTask,$asyncBody=Bridge.fn.bind(this,function(){for(;;){$step=System.Array.min([0,1],$step);switch($step){case 0:Bridge.Spaf.LoadableViewModel.prototype.OnLoad.call(this,parameters);articlesTask=this.LoadArticles(realworld.spaf.Services.impl.ArticleRequestBuilder.Default().WithLimit(this._settings.realworld$spaf$Services$ISettings$ArticleInPage));loadTagsTask=this.LoadTags();$task1=System.Threading.Tasks.Task.whenAll(articlesTask,loadTagsTask);$step=1;$task1.continueWith($asyncBody,!0);return;case 1:$task1.getAwaitedResult();this.RefreshPaginator(articlesTask.getResult());return;default:return}}},arguments);$asyncBody()},OnLeave:function(){Bridge.Spaf.LoadableViewModel.prototype.OnLeave.call(this);this._messenger.Bridge$Messenger$IMessenger$Unsubscribe(realworld.spaf.Services.impl.UserService,this,Bridge.Spaf.SpafApp.LoginId)},GoToUser:function(article){this._navigator.Bridge$Navigation$INavigator$Navigate(Bridge.Spaf.SpafApp.ProfileId,function(_o1){return _o1.add("username",article.Author.Username),_o1}(new(System.Collections.Generic.Dictionary$2(System.String,System.Object))))},GoToArticle:function(article){this._navigator.Bridge$Navigation$INavigator$Navigate(Bridge.Spaf.SpafApp.ArticleId,function(_o1){return _o1.add("slug",article.Slug),_o1}(new(System.Collections.Generic.Dictionary$2(System.String,System.Object))))},AddToFavourite:function(article){var $step=0,$task2,$taskResult2,$task3,$taskResult3,$tcs=new System.Threading.Tasks.TaskCompletionSource,singleArticle,$taskResult1,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=System.Array.min([0,1,2,3,4,5],$step);switch($step){case 0:if(!this.IsLogged()){$tcs.setResult(null);return}if(article.Favorited){$step=1;continue}else{$step=3;continue}case 1:$task2=this._resources.realworld$spaf$Services$IArticleResources$UnFavorite(article.Slug);$step=2;$task2.continueWith($asyncBody);return;case 2:$taskResult2=$task2.getAwaitedResult();$taskResult1=$taskResult2;$step=5;continue;case 3:$task3=this._resources.realworld$spaf$Services$IArticleResources$Favorite(article.Slug);$step=4;$task3.continueWith($asyncBody);return;case 4:$taskResult3=$task3.getAwaitedResult();$taskResult1=$taskResult3;$step=5;continue;case 5:singleArticle=$taskResult1;this.Articles.replace(article,singleArticle.Article);$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=System.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},ResetTabsForFeed:function(){var $step=0,$task1,$taskResult1,$tcs=new System.Threading.Tasks.TaskCompletionSource,articleResponse,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=System.Array.min([0,1],$step);switch($step){case 0:this.ActiveTabIndex(-2);this.Tabs.removeAll();this._tagFilter=null;$task1=this.LoadFeed(realworld.spaf.Classes.FeedRequestBuilder.Default().WithLimit(this._settings.realworld$spaf$Services$ISettings$ArticleInPage));$step=1;$task1.continueWith($asyncBody);return;case 1:$taskResult1=$task1.getAwaitedResult();articleResponse=$taskResult1;this.RefreshPaginator(articleResponse);$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=System.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},ResetTabs:function(){var $step=0,$task1,$taskResult1,$tcs=new System.Threading.Tasks.TaskCompletionSource,articleResponse,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=System.Array.min([0,1],$step);switch($step){case 0:this.ActiveTabIndex(-1);this.Tabs.removeAll();this._tagFilter=null;$task1=this.LoadArticles(realworld.spaf.Services.impl.ArticleRequestBuilder.Default().WithLimit(this._settings.realworld$spaf$Services$ISettings$ArticleInPage));$step=1;$task1.continueWith($asyncBody);return;case 1:$taskResult1=$task1.getAwaitedResult();articleResponse=$taskResult1;this.RefreshPaginator(articleResponse);$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=System.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},GoToPage:function(paginator){var $step=0,$task1,$taskResult1,$tcs=new System.Threading.Tasks.TaskCompletionSource,request,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=System.Array.min([0,1],$step);switch($step){case 0:System.Linq.Enumerable.from(this.Pages()).single(function(s){return s.Active()}).Active(!1);paginator.Active(!0);request=realworld.spaf.Services.impl.ArticleRequestBuilder.Default().WithOffSet(Bridge.Int.mul(paginator.Page-1|0,this._settings.realworld$spaf$Services$ISettings$ArticleInPage)).WithLimit(this._settings.realworld$spaf$Services$ISettings$ArticleInPage);System.String.isNullOrEmpty(this._tagFilter)||(request=request.WithTag(this._tagFilter));$task1=this.LoadArticles(request);$step=1;$task1.continueWith($asyncBody);return;case 1:$taskResult1=$task1.getAwaitedResult();$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=System.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},FilterByTag:function(tag){var $step=0,$task1,$tcs=new System.Threading.Tasks.TaskCompletionSource,tabName,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=System.Array.min([0,1],$step);switch($step){case 0:tabName=System.String.format("#{0}",[tag]);$task1=this.ArticlesForTab(tabName);$step=1;$task1.continueWith($asyncBody);return;case 1:$task1.getAwaitedResult();$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=System.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},ArticlesForTab:function(tab){var $step=0,$task1,$taskResult1,$tcs=new System.Threading.Tasks.TaskCompletionSource,tagName,actualIndex,articles,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=System.Array.min([0,1],$step);switch($step){case 0:tagName=System.String.trimStart(tab,[35]);this._tagFilter=tagName;actualIndex=this.Tabs().indexOf(tab);actualIndex===-1&&this.Tabs.push(tab);this.ActiveTabIndex(this.Tabs().indexOf(tab));$task1=this.LoadArticles(realworld.spaf.Services.impl.ArticleRequestBuilder.Default().WithTag(tagName).WithLimit(this._settings.realworld$spaf$Services$ISettings$ArticleInPage));$step=1;$task1.continueWith($asyncBody);return;case 1:$taskResult1=$task1.getAwaitedResult();articles=$taskResult1;this.RefreshPaginator(articles);$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=System.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},LoadArticles:function(request){var $step=0,$task1,$taskResult1,$tcs=new System.Threading.Tasks.TaskCompletionSource,articleResoResponse,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=System.Array.min([0,1],$step);switch($step){case 0:$task1=this._resources.realworld$spaf$Services$IArticleResources$GetArticles(request);$step=1;$task1.continueWith($asyncBody);return;case 1:$taskResult1=$task1.getAwaitedResult();articleResoResponse=$taskResult1;this.Articles.removeAll();this.Articles.push.apply(this.Articles,articleResoResponse.Articles);$tcs.setResult(articleResoResponse);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=System.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},LoadFeed:function(request){var $step=0,$task1,$taskResult1,$tcs=new System.Threading.Tasks.TaskCompletionSource,feedResponse,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=System.Array.min([0,1],$step);switch($step){case 0:$task1=this._feedResources.realworld$spaf$Services$IFeedResources$GetFeed(request);$step=1;$task1.continueWith($asyncBody);return;case 1:$taskResult1=$task1.getAwaitedResult();feedResponse=$taskResult1;this.Articles.removeAll();this.Articles.push.apply(this.Articles,feedResponse.Articles);$tcs.setResult(feedResponse);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=System.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},LoadTags:function(){var $step=0,$task1,$taskResult1,$tcs=new System.Threading.Tasks.TaskCompletionSource,tags,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=System.Array.min([0,1],$step);switch($step){case 0:$task1=this._resources.realworld$spaf$Services$IArticleResources$GetTags();$step=1;$task1.continueWith($asyncBody);return;case 1:$taskResult1=$task1.getAwaitedResult();tags=$taskResult1;this.Tags.removeAll();this.Tags.push.apply(this.Tags,tags.Tags);$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=System.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},RefreshPaginator:function(articleResoResponse){if(this.Pages.removeAll(),System.Linq.Enumerable.from(articleResoResponse.Articles).any()){var pagesCount=System.Int64.clip32(articleResoResponse.ArticlesCount.div(System.Int64(articleResoResponse.Articles.length))),range=System.Linq.Enumerable.range(1,pagesCount),pages=range.select(function(s){var $t;return $t=new realworld.spaf.Models.Paginator,$t.Page=s,$t}).toArray(realworld.spaf.Models.Paginator);pages[System.Array.index(0,pages)].Active(!0);this.Pages.push.apply(this.Pages,pages)}}}});Bridge.define("realworld.spaf.ViewModels.LoginViewModel",{inherits:[Bridge.Spaf.LoadableViewModel],fields:{_navigator:null,_userService:null,Email:null,Password:null,IsBusy:null,Errors:null},ctors:{ctor:function(navigator,userService){this.$initialize();Bridge.Spaf.LoadableViewModel.ctor.call(this);this._navigator=navigator;this._userService=userService;this.Email=ko.observable();this.Password=ko.observable();this.IsBusy=ko.observable();this.Errors=ko.observableArray()}},methods:{ElementId:function(){return Bridge.Spaf.SpafApp.LoginId},Login:function(){return this.IsBusy(!0),this.Errors.removeAll(),this._userService.realworld$spaf$Services$IUserService$Login(this.Email(),this.Password()).continueWith(Bridge.fn.bind(this,function(c){var firstException,e,errors;this.IsBusy(!1);c.isFaulted()?(firstException=System.Linq.Enumerable.from(c.exception.innerExceptions).first(),Bridge.is(firstException,Bridge.PromiseException)?(e=Bridge.cast(System.Linq.Enumerable.from(c.exception.innerExceptions).first(),Bridge.PromiseException),errors=realworld.spaf.Classes.Extensions.GetValidationErrors(e),this.Errors.push.apply(this.Errors,System.Linq.Enumerable.from(errors).toArray())):this._navigator.Bridge$Navigation$INavigator$Navigate(Bridge.Spaf.SpafApp.HomeId,void 0)):this._navigator.Bridge$Navigation$INavigator$Navigate(Bridge.Spaf.SpafApp.HomeId,void 0)}))}}});Bridge.define("realworld.spaf.ViewModels.MainViewModel",{fields:{_messenger:null,_userService:null,IsLogged:null,ActualPageId:null},ctors:{ctor:function(messenger,userService,navigator){this.$initialize();this._messenger=messenger;this._userService=userService;this.IsLogged=ko.observable(!1);this.ActualPageId=ko.observable(Bridge.Spaf.SpafApp.HomeId);this._messenger.Bridge$Messenger$IMessenger$Subscribe(realworld.spaf.Services.impl.UserService,this,Bridge.Spaf.SpafApp.Messages.LoginDone,Bridge.fn.bind(this,function(){this.IsLogged(!0)}),void 0);navigator.Bridge$Navigation$INavigator$addOnNavigated(Bridge.fn.bind(this,function(sender,loadable){var vm=Bridge.cast(loadable,Bridge.Spaf.LoadableViewModel);this.ActualPageId(vm.ElementId())}))}},methods:{Start:function(){var $step=0,$task1,$tcs=new System.Threading.Tasks.TaskCompletionSource,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=System.Array.min([0,1],$step);switch($step){case 0:ko.applyBindings(this);$task1=this._userService.realworld$spaf$Services$IUserService$TryAutoLoginWithStoredToken();$step=1;$task1.continueWith($asyncBody);return;case 1:$task1.getAwaitedResult();$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=System.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task}}});Bridge.define("realworld.spaf.ViewModels.ProfileModel",{fields:{Image:null,Username:null,Bio:null,Following:null,Articles:null,UserArticles:null,Favourtites:null},ctors:{ctor:function(){this.$initialize();this.Image=ko.observable();this.Username=ko.observable();this.Bio=ko.observable();this.Following=ko.observable();this.Articles=ko.observableArray()}},methods:{MapMe:function(profile){this.Image(profile.Image);this.Username(profile.Username);this.Bio(profile.Bio);this.Following(profile.Following)},ShowArticles:function(){this.Articles.removeAll();this.Articles.push.apply(this.Articles,System.Linq.Enumerable.from(this.UserArticles).toArray())},ShowFavourites:function(){this.Articles.removeAll();this.Articles.push.apply(this.Articles,System.Linq.Enumerable.from(this.Favourtites).toArray())}}});Bridge.define("realworld.spaf.ViewModels.ProfileViewModel",{inherits:[Bridge.Spaf.LoadableViewModel],fields:{_profileResource:null,_userService:null,_articleResources:null,_navigator:null,_messenger:null,ProfileModel:null,ActiveTabIndex:null,IsLogged:null},alias:["OnLoad","Bridge$Navigation$IAmLoadable$OnLoad","OnLeave","Bridge$Navigation$IAmLoadable$OnLeave"],ctors:{ctor:function(profileResource,userService,articleResources,navigator,messenger){this.$initialize();Bridge.Spaf.LoadableViewModel.ctor.call(this);this.ProfileModel=new realworld.spaf.ViewModels.ProfileModel;this._profileResource=profileResource;this._userService=userService;this._articleResources=articleResources;this._navigator=navigator;this._messenger=messenger;this.ActiveTabIndex=ko.observable(0);this.IsLogged=ko.observable(this._userService.realworld$spaf$Services$IUserService$IsLogged);this._messenger.Bridge$Messenger$IMessenger$Subscribe(realworld.spaf.Services.impl.UserService,this,Bridge.Spaf.SpafApp.Messages.LoginDone,Bridge.fn.bind(this,function(){this.IsLogged(!0)}),void 0)}},methods:{ElementId:function(){return Bridge.Spaf.SpafApp.ProfileId},OnLoad:function(parameters){var $step=0,$task1,username,userTask,articleTask,favouriteTask,$asyncBody=Bridge.fn.bind(this,function(){for(;;){$step=System.Array.min([0,1],$step);switch($step){case 0:Bridge.Spaf.LoadableViewModel.prototype.OnLoad.call(this,parameters);username="";try{username=Bridge.Navigation.NavigationUtility.GetParameter(System.String,parameters,"username")}catch($e1){if($e1=System.Exception.create($e1),!this._userService.realworld$spaf$Services$IUserService$IsLogged)throw new System.Exception("No username passed and you are not logged!");username=this._userService.realworld$spaf$Services$IUserService$LoggedUser.Username}userTask=this.LoadUser(username);articleTask=this.LoadArticles(username);favouriteTask=this.LoadFavouritesArticles(username);$task1=System.Threading.Tasks.Task.whenAll(userTask,articleTask,favouriteTask);$step=1;$task1.continueWith($asyncBody,!0);return;case 1:$task1.getAwaitedResult();this.ProfileModel.ShowArticles();return;default:return}}},arguments);$asyncBody()},OnLeave:function(){Bridge.Spaf.LoadableViewModel.prototype.OnLeave.call(this);this._messenger.Bridge$Messenger$IMessenger$Unsubscribe(realworld.spaf.Services.impl.UserService,this,Bridge.Spaf.SpafApp.LoginId)},AddToFavourite:function(article){var $step=0,$task2,$taskResult2,$task3,$taskResult3,$tcs=new System.Threading.Tasks.TaskCompletionSource,singleArticle,$taskResult1,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=System.Array.min([0,1,2,3,4,5],$step);switch($step){case 0:if(!this.IsLogged()){$tcs.setResult(null);return}if(article.Favorited){$step=1;continue}else{$step=3;continue}case 1:$task2=this._articleResources.realworld$spaf$Services$IArticleResources$UnFavorite(article.Slug);$step=2;$task2.continueWith($asyncBody);return;case 2:$taskResult2=$task2.getAwaitedResult();$taskResult1=$taskResult2;$step=5;continue;case 3:$task3=this._articleResources.realworld$spaf$Services$IArticleResources$Favorite(article.Slug);$step=4;$task3.continueWith($asyncBody);return;case 4:$taskResult3=$task3.getAwaitedResult();$taskResult1=$taskResult3;$step=5;continue;case 5:singleArticle=$taskResult1;this.ProfileModel.Articles.replace(article,singleArticle.Article);$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=System.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},Follow:function(){var $step=0,$task2,$taskResult2,$task3,$taskResult3,$tcs=new System.Threading.Tasks.TaskCompletionSource,username,follow,$taskResult1,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=System.Array.min([0,1,2,3,4,5],$step);switch($step){case 0:if(username=this.ProfileModel.Username(),this.ProfileModel.Following()){$step=1;continue}else{$step=3;continue}case 1:$task2=this._profileResource.realworld$spaf$Services$IProfileResources$UnFollow(username);$step=2;$task2.continueWith($asyncBody);return;case 2:$taskResult2=$task2.getAwaitedResult();$taskResult1=$taskResult2;$step=5;continue;case 3:$task3=this._profileResource.realworld$spaf$Services$IProfileResources$Follow(username);$step=4;$task3.continueWith($asyncBody);return;case 4:$taskResult3=$task3.getAwaitedResult();$taskResult1=$taskResult3;$step=5;continue;case 5:follow=$taskResult1;this.ProfileModel.Following(follow.Profile.Following);$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=System.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},GoToUser:function(article){this._navigator.Bridge$Navigation$INavigator$Navigate(Bridge.Spaf.SpafApp.ProfileId,function(_o1){return _o1.add("username",article.Author.Username),_o1}(new(System.Collections.Generic.Dictionary$2(System.String,System.Object))))},GoToArticle:function(article){this._navigator.Bridge$Navigation$INavigator$Navigate(Bridge.Spaf.SpafApp.ArticleId,function(_o1){return _o1.add("slug",article.Slug),_o1}(new(System.Collections.Generic.Dictionary$2(System.String,System.Object))))},ShowArticles:function(){this.ActiveTabIndex(0);this.ProfileModel.ShowArticles()},ShowFavourites:function(){this.ActiveTabIndex(1);this.ProfileModel.ShowFavourites()},LoadUser:function(username){var $step=0,$task1,$taskResult1,$tcs=new System.Threading.Tasks.TaskCompletionSource,profileResponse,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=System.Array.min([0,1],$step);switch($step){case 0:$task1=this._profileResource.realworld$spaf$Services$IProfileResources$Get(username);$step=1;$task1.continueWith($asyncBody);return;case 1:$taskResult1=$task1.getAwaitedResult();profileResponse=$taskResult1;this.ProfileModel.MapMe(profileResponse.Profile);$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=System.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},LoadArticles:function(username){var $step=0,$task1,$taskResult1,$tcs=new System.Threading.Tasks.TaskCompletionSource,articles,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=System.Array.min([0,1],$step);switch($step){case 0:$task1=this._articleResources.realworld$spaf$Services$IArticleResources$GetArticles(realworld.spaf.Services.impl.ArticleRequestBuilder.Default().WithLimit(5).OfAuthor(username));$step=1;$task1.continueWith($asyncBody);return;case 1:$taskResult1=$task1.getAwaitedResult();articles=$taskResult1;this.ProfileModel.UserArticles=articles.Articles;$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=System.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},LoadFavouritesArticles:function(username){var $step=0,$task1,$taskResult1,$tcs=new System.Threading.Tasks.TaskCompletionSource,articles,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=System.Array.min([0,1],$step);switch($step){case 0:$task1=this._articleResources.realworld$spaf$Services$IArticleResources$GetArticles(realworld.spaf.Services.impl.ArticleRequestBuilder.Default().WithLimit(5).OfFavorite(username));$step=1;$task1.continueWith($asyncBody);return;case 1:$taskResult1=$task1.getAwaitedResult();articles=$taskResult1;this.ProfileModel.Favourtites=articles.Articles;$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=System.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task}}});Bridge.define("realworld.spaf.ViewModels.RegisterViewModel",{inherits:[Bridge.Spaf.LoadableViewModel],fields:{_navigator:null,_userService:null,Username:null,Email:null,Password:null,Errors:null},ctors:{ctor:function(navigator,userService){this.$initialize();Bridge.Spaf.LoadableViewModel.ctor.call(this);this._navigator=navigator;this._userService=userService;this.Username=ko.observable();this.Email=ko.observable();this.Password=ko.observable();this.Errors=ko.observableArray()}},methods:{ElementId:function(){return Bridge.Spaf.SpafApp.RegisterId},Register:function(){var $step=0,$task1,$tcs=new System.Threading.Tasks.TaskCompletionSource,e,errors,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=System.Array.min([1,2,3,4],$step);switch($step){case 1:this.Errors.removeAll();$task1=this._userService.realworld$spaf$Services$IUserService$Register(this.Username(),this.Email(),this.Password());$step=2;$task1.continueWith($asyncBody);return;case 2:$task1.getAwaitedResult();this._navigator.Bridge$Navigation$INavigator$Navigate(Bridge.Spaf.SpafApp.HomeId,void 0);$step=4;continue;case 3:errors=realworld.spaf.Classes.Extensions.GetValidationErrors(e);this.Errors.push.apply(this.Errors,System.Linq.Enumerable.from(errors).toArray());$async_e=null;$step=4;continue;case 4:$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){if($async_e=System.Exception.create($async_e1),$step>=1&&$step<=2&&Bridge.is($async_e,Bridge.PromiseException)){e=$async_e;$step=3;$asyncBody();return}$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task}}});Bridge.define("realworld.spaf.ViewModels.SettingsViewModel",{inherits:[Bridge.Spaf.LoadableViewModel],fields:{_userService:null,_settingsResources:null,_navigator:null,ImageUri:null,Username:null,Biography:null,Email:null,NewPassword:null,Errors:null},ctors:{ctor:function(userService,settingsResources,navigator){this.$initialize();Bridge.Spaf.LoadableViewModel.ctor.call(this);this._userService=userService;this._settingsResources=settingsResources;this._navigator=navigator;this.ImageUri=ko.observable();this.Username=ko.observable();this.Biography=ko.observable();this.Email=ko.observable();this.NewPassword=ko.observable();this.Errors=ko.observableArray();this.PopulateEntries()}},methods:{ElementId:function(){return Bridge.Spaf.SpafApp.SettingsId},PopulateEntries:function(){var user=this._userService.realworld$spaf$Services$IUserService$LoggedUser;this.Username(user.Username);this.Email(user.Email);this.ImageUri(user.Image);this.Biography(user.Bio)},UpdateSettings:function(){var $step=0,$task1,$taskResult1,$tcs=new System.Threading.Tasks.TaskCompletionSource,settingsRequest,$t,userUpdated,e,errors,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=System.Array.min([1,2,3,4],$step);switch($step){case 1:settingsRequest=($t=new realworld.spaf.Models.Request.SettingsRequest,$t.Username=this.Username(),$t.NewPassword=this.NewPassword(),$t.Biography=this.Biography(),$t.Email=this.Email(),$t.ImageUri=this.ImageUri(),$t);$task1=this._settingsResources.realworld$spaf$Services$ISettingsResources$UpdateSettings(settingsRequest);$step=2;$task1.continueWith($asyncBody);return;case 2:$taskResult1=$task1.getAwaitedResult();userUpdated=$taskResult1;this._navigator.Bridge$Navigation$INavigator$Navigate(Bridge.Spaf.SpafApp.ProfileId,void 0);$step=4;continue;case 3:errors=realworld.spaf.Classes.Extensions.GetValidationErrors(e);this.Errors.push.apply(this.Errors,System.Linq.Enumerable.from(errors).toArray());$async_e=null;$step=4;continue;case 4:$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){if($async_e=System.Exception.create($async_e1),$step>=1&&$step<=2&&Bridge.is($async_e,Bridge.PromiseException)){e=$async_e;$step=3;$asyncBody();return}$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task}}});Bridge.define("realworld.spaf.Services.impl.AuthorizedResourceBase",{inherits:[realworld.spaf.Services.impl.ResourceBase],fields:{UserService:null},ctors:{ctor:function(userService){this.$initialize();realworld.spaf.Services.impl.ResourceBase.ctor.call(this);this.UserService=userService}},methods:{MakeAuthorizedCall:function(T,options){if(!this.UserService.realworld$spaf$Services$IUserService$IsLogged)throw new System.Exception("You must be logged to use this resource");return options.beforeSend=Bridge.fn.bind(this,function(xhr){return xhr.setRequestHeader("Authorization",System.String.format("Token {0}",[this.UserService.realworld$spaf$Services$IUserService$LoggedUser.Token])),!0}),realworld.spaf.Services.impl.ResourceBase.prototype.MakeCall.call(this,T,options)}}});Bridge.define("realworld.spaf.Services.impl.LocalStorageRepository",{inherits:[realworld.spaf.Services.IRepository],statics:{fields:{TokenKey:null},ctors:{init:function(){this.TokenKey="token"}}},fields:{_storage:null},alias:["SaveToken","realworld$spaf$Services$IRepository$SaveToken","GetTokenIfExist","realworld$spaf$Services$IRepository$GetTokenIfExist","DeleteToken","realworld$spaf$Services$IRepository$DeleteToken"],ctors:{ctor:function(){this.$initialize();this._storage=window.localStorage}},methods:{SaveToken:function(token){this._storage.setItem(realworld.spaf.Services.impl.LocalStorageRepository.TokenKey,token)},GetTokenIfExist:function(){var token=this._storage.getItem(realworld.spaf.Services.impl.LocalStorageRepository.TokenKey);return token!=null?Bridge.toString(token):null},DeleteToken:function(){this._storage.removeItem(realworld.spaf.Services.impl.LocalStorageRepository.TokenKey)}}});Bridge.define("realworld.spaf.Services.impl.Settings",{inherits:[realworld.spaf.Services.ISettings],fields:{ApiUri:null,ArticleInPage:0},alias:["ApiUri","realworld$spaf$Services$ISettings$ApiUri","ArticleInPage","realworld$spaf$Services$ISettings$ArticleInPage"],ctors:{init:function(){this.ApiUri="https://conduit.productionready.io/api";this.ArticleInPage=10}}});Bridge.define("realworld.spaf.Services.impl.UserResources",{inherits:[realworld.spaf.Services.impl.ResourceBase,realworld.spaf.Services.IUserResources],fields:{_settings:null},alias:["Login","realworld$spaf$Services$IUserResources$Login","Register","realworld$spaf$Services$IUserResources$Register","GetCurrentUser","realworld$spaf$Services$IUserResources$GetCurrentUser"],ctors:{ctor:function(settings){this.$initialize();realworld.spaf.Services.impl.ResourceBase.ctor.call(this);this._settings=settings}},methods:{Login:function(loginRequest){var options={url:System.String.format("{0}/users/login",[this._settings.realworld$spaf$Services$ISettings$ApiUri]),type:"POST",dataType:"json",contentType:"application/json",data:Newtonsoft.Json.JsonConvert.SerializeObject(loginRequest)};return realworld.spaf.Services.impl.ResourceBase.prototype.MakeCall.call(this,realworld.spaf.Models.Response.SignResponse,options)},Register:function(loginRequest){var options={url:System.String.format("{0}/users",[this._settings.realworld$spaf$Services$ISettings$ApiUri]),type:"POST",dataType:"json",contentType:"application/json",data:Newtonsoft.Json.JsonConvert.SerializeObject(loginRequest)};return realworld.spaf.Services.impl.ResourceBase.prototype.MakeCall.call(this,realworld.spaf.Models.Response.SignResponse,options)},GetCurrentUser:function(token){var options={url:System.String.format("{0}/user",[this._settings.realworld$spaf$Services$ISettings$ApiUri]),type:"GET",dataType:"json",beforeSend:function(xhr){return xhr.setRequestHeader("Authorization",System.String.format("Token {0}",[token])),!0}};return realworld.spaf.Services.impl.ResourceBase.prototype.MakeCall.call(this,realworld.spaf.Models.Response.SignResponse,options)}}});Bridge.define("realworld.spaf.Services.impl.UserService",{inherits:[realworld.spaf.Services.IUserService],fields:{_userResources:null,_messenger:null,_repository:null,LoggedUser:null},props:{IsLogged:{get:function(){return this.LoggedUser!=null}}},alias:["LoggedUser","realworld$spaf$Services$IUserService$LoggedUser","IsLogged","realworld$spaf$Services$IUserService$IsLogged","Login","realworld$spaf$Services$IUserService$Login","Register","realworld$spaf$Services$IUserService$Register","TryAutoLoginWithStoredToken","realworld$spaf$Services$IUserService$TryAutoLoginWithStoredToken"],ctors:{ctor:function(userResources,messenger,repository){this.$initialize();this._userResources=userResources;this._messenger=messenger;this._repository=repository}},methods:{Login:function(mail,password){var $step=0,$task1,$taskResult1,$tcs=new System.Threading.Tasks.TaskCompletionSource,loginResponse,$t,$t1,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=System.Array.min([0,1],$step);switch($step){case 0:$task1=this._userResources.realworld$spaf$Services$IUserResources$Login(($t=new realworld.spaf.Models.Request.SignRequest,$t.User=($t1=new realworld.spaf.Models.Request.UserRequest,$t1.Email=mail,$t1.Password=password,$t1),$t));$step=1;$task1.continueWith($asyncBody);return;case 1:$taskResult1=$task1.getAwaitedResult();loginResponse=$taskResult1;this.LoggedUser=loginResponse.User;this._repository.realworld$spaf$Services$IRepository$SaveToken(loginResponse.User.Token);this._messenger.Bridge$Messenger$IMessenger$Send(Bridge.global.realworld.spaf.Services.impl.UserService,this,Bridge.Spaf.SpafApp.Messages.LoginDone);$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=System.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},Register:function(username,mail,password){var $step=0,$task1,$taskResult1,$tcs=new System.Threading.Tasks.TaskCompletionSource,loginResponse,$t,$t1,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=System.Array.min([0,1],$step);switch($step){case 0:$task1=this._userResources.realworld$spaf$Services$IUserResources$Register(($t=new realworld.spaf.Models.Request.SignRequest,$t.User=($t1=new realworld.spaf.Models.Request.UserRequest,$t1.Email=mail,$t1.Password=password,$t1.Username=username,$t1),$t));$step=1;$task1.continueWith($asyncBody);return;case 1:$taskResult1=$task1.getAwaitedResult();loginResponse=$taskResult1;this.LoggedUser=loginResponse.User;this._repository.realworld$spaf$Services$IRepository$SaveToken(loginResponse.User.Token);this._messenger.Bridge$Messenger$IMessenger$Send(Bridge.global.realworld.spaf.Services.impl.UserService,this,Bridge.Spaf.SpafApp.Messages.LoginDone);$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=System.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},TryAutoLoginWithStoredToken:function(){var $step=0,$task1,$taskResult1,$tcs=new System.Threading.Tasks.TaskCompletionSource,storedToken,loginResponse,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=System.Array.min([0,1,2,3,4],$step);switch($step){case 0:if(storedToken=this._repository.realworld$spaf$Services$IRepository$GetTokenIfExist(),storedToken==null){$tcs.setResult(null);return}$step=1;continue;case 1:$task1=this._userResources.realworld$spaf$Services$IUserResources$GetCurrentUser(storedToken);$step=2;$task1.continueWith($asyncBody);return;case 2:$taskResult1=$task1.getAwaitedResult();loginResponse=$taskResult1;this.LoggedUser=loginResponse.User;this._repository.realworld$spaf$Services$IRepository$SaveToken(loginResponse.User.Token);this._messenger.Bridge$Messenger$IMessenger$Send(Bridge.global.realworld.spaf.Services.impl.UserService,this,Bridge.Spaf.SpafApp.Messages.LoginDone);$step=4;continue;case 3:this._repository.realworld$spaf$Services$IRepository$DeleteToken();this.LoggedUser=null;$async_e=null;$step=4;continue;case 4:$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){if($async_e=System.Exception.create($async_e1),$step>=1&&$step<=2&&Bridge.is($async_e,Bridge.PromiseException)){$step=3;$asyncBody();return}$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task}}});Bridge.define("realworld.spaf.Services.impl.ArticleResources",{inherits:[realworld.spaf.Services.impl.AuthorizedResourceBase,realworld.spaf.Services.IArticleResources],fields:{_settings:null},alias:["GetArticles","realworld$spaf$Services$IArticleResources$GetArticles","GetTags","realworld$spaf$Services$IArticleResources$GetTags","GetArticle","realworld$spaf$Services$IArticleResources$GetArticle","Favorite","realworld$spaf$Services$IArticleResources$Favorite","UnFavorite","realworld$spaf$Services$IArticleResources$UnFavorite","Create","realworld$spaf$Services$IArticleResources$Create","GetArticleComments","realworld$spaf$Services$IArticleResources$GetArticleComments","AddComment","realworld$spaf$Services$IArticleResources$AddComment"],ctors:{ctor:function(settings,userService){this.$initialize();realworld.spaf.Services.impl.AuthorizedResourceBase.ctor.call(this,userService);this._settings=settings}},methods:{GetArticles:function(builder){var options={url:System.String.format("{0}/{1}",this._settings.realworld$spaf$Services$ISettings$ApiUri,builder.Build()),type:"GET",dataType:"json"};return this.UserService.realworld$spaf$Services$IUserService$IsLogged?this.MakeAuthorizedCall(realworld.spaf.Models.Response.ArticleResponse,options):this.MakeCall(realworld.spaf.Models.Response.ArticleResponse,options)},GetTags:function(){var options={url:System.String.format("{0}/tags",[this._settings.realworld$spaf$Services$ISettings$ApiUri]),type:"GET",dataType:"json"};return realworld.spaf.Services.impl.AuthorizedResourceBase.prototype.MakeCall.call(this,realworld.spaf.Models.Response.TagsResponse,options)},GetArticle:function(slug){var options={url:System.String.format("{0}/articles/{1}",this._settings.realworld$spaf$Services$ISettings$ApiUri,slug),type:"GET",dataType:"json"};return realworld.spaf.Services.impl.AuthorizedResourceBase.prototype.MakeCall.call(this,realworld.spaf.Models.Response.SingleArticleResponse,options)},Favorite:function(slug){var options={url:System.String.format("{0}/articles/{1}/favorite",this._settings.realworld$spaf$Services$ISettings$ApiUri,slug),type:"POST",dataType:"json",contentType:"application/json"};return this.MakeAuthorizedCall(realworld.spaf.Models.Response.SingleArticleResponse,options)},UnFavorite:function(slug){var options={url:System.String.format("{0}/articles/{1}/favorite",this._settings.realworld$spaf$Services$ISettings$ApiUri,slug),type:"DELETE",dataType:"json",contentType:"application/json"};return this.MakeAuthorizedCall(realworld.spaf.Models.Response.SingleArticleResponse,options)},Create:function(newArticle){var options={url:System.String.format("{0}/articles",[this._settings.realworld$spaf$Services$ISettings$ApiUri]),type:"POST",dataType:"json",contentType:"application/json",data:Newtonsoft.Json.JsonConvert.SerializeObject(newArticle)};return this.MakeAuthorizedCall(realworld.spaf.Models.Response.SingleArticleResponse,options)},GetArticleComments:function(slug){var options={url:System.String.format("{0}/articles/{1}/comments",this._settings.realworld$spaf$Services$ISettings$ApiUri,slug),type:"GET",dataType:"json"};return realworld.spaf.Services.impl.AuthorizedResourceBase.prototype.MakeCall.call(this,realworld.spaf.Models.Response.CommentsResponse,options)},AddComment:function(slug,comment){var $t,options={url:System.String.format("{0}/articles/{1}/comments",this._settings.realworld$spaf$Services$ISettings$ApiUri,slug),type:"POST",dataType:"json",contentType:"application/json",data:Newtonsoft.Json.JsonConvert.SerializeObject(($t=new realworld.spaf.Models.Comment,$t.Body=comment,$t))};return this.MakeAuthorizedCall(realworld.spaf.Models.Response.SingleCommentResponse,options)}}});Bridge.define("realworld.spaf.Services.impl.FeedResources",{inherits:[realworld.spaf.Services.impl.AuthorizedResourceBase,realworld.spaf.Services.IFeedResources],fields:{_settings:null},alias:["GetFeed","realworld$spaf$Services$IFeedResources$GetFeed"],ctors:{ctor:function(settings,userService){this.$initialize();realworld.spaf.Services.impl.AuthorizedResourceBase.ctor.call(this,userService);this._settings=settings}},methods:{GetFeed:function(builder){var options={url:System.String.format("{0}/{1}",this._settings.realworld$spaf$Services$ISettings$ApiUri,builder.Build()),type:"GET",dataType:"json"};return this.MakeAuthorizedCall(realworld.spaf.Models.Response.ArticleResponse,options)}}});Bridge.define("realworld.spaf.Services.impl.ProfileResources",{inherits:[realworld.spaf.Services.impl.AuthorizedResourceBase,realworld.spaf.Services.IProfileResources],fields:{_settings:null},alias:["Follow","realworld$spaf$Services$IProfileResources$Follow","UnFollow","realworld$spaf$Services$IProfileResources$UnFollow","Get","realworld$spaf$Services$IProfileResources$Get"],ctors:{ctor:function(userService,settings){this.$initialize();realworld.spaf.Services.impl.AuthorizedResourceBase.ctor.call(this,userService);this._settings=settings}},methods:{Follow:function(username){var options={url:System.String.format("{0}/profiles/{1}/follow",this._settings.realworld$spaf$Services$ISettings$ApiUri,username),type:"POST",dataType:"json",contentType:"application/json"};return this.MakeAuthorizedCall(realworld.spaf.Models.Response.FollowResponse,options)},UnFollow:function(username){var options={url:System.String.format("{0}/profiles/{1}/follow",this._settings.realworld$spaf$Services$ISettings$ApiUri,username),type:"DELETE",dataType:"json",contentType:"application/json"};return this.MakeAuthorizedCall(realworld.spaf.Models.Response.FollowResponse,options)},Get:function(username){var options={url:System.String.format("{0}/profiles/{1}",this._settings.realworld$spaf$Services$ISettings$ApiUri,username),type:"GET",dataType:"json",contentType:"application/json"};return this.UserService.realworld$spaf$Services$IUserService$IsLogged?this.MakeAuthorizedCall(realworld.spaf.Models.Response.ProfileResponse,options):realworld.spaf.Services.impl.AuthorizedResourceBase.prototype.MakeCall.call(this,realworld.spaf.Models.Response.ProfileResponse,options)}}});Bridge.define("realworld.spaf.Services.impl.SettingsResources",{inherits:[realworld.spaf.Services.impl.AuthorizedResourceBase,realworld.spaf.Services.ISettingsResources],fields:{_settings:null},alias:["UpdateSettings","realworld$spaf$Services$ISettingsResources$UpdateSettings"],ctors:{ctor:function(settings,userService){this.$initialize();realworld.spaf.Services.impl.AuthorizedResourceBase.ctor.call(this,userService);this._settings=settings}},methods:{UpdateSettings:function(settingsRequest){var options={url:System.String.format("{0}/user",[this._settings.realworld$spaf$Services$ISettings$ApiUri]),type:"PUT",dataType:"json",contentType:"application/json",data:Newtonsoft.Json.JsonConvert.SerializeObject(settingsRequest)};return this.MakeAuthorizedCall(realworld.spaf.Models.Response.SettingsResponse,options)}}})});
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAiZmlsZSI6ICJyZWFsd29ybGQuc3BhZi5taW4uanMiLAogICJzb3VyY2VSb290IjogIiIsCiAgInNvdXJjZXMiOiBbXSwKICAibmFtZXMiOiBbXSwKICAibWFwcGluZ3MiOiAiIiwKICAic291cmNlc0NvbnRlbnQiOiBbXQp9Cg==
